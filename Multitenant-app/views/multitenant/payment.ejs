<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EasyApps || Payment</title>
  <link rel="icon" type="image/png" href="/multitenant/img/easyicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --left-bg: #e9ecef;
      --right-bg: #ffffff;
    }
    html, body { height: 100%; margin: 0; }
    .row-full { min-height: 100vh; }
    .g-0 { --bs-gutter-x: 0; --bs-gutter-y: 0; }
    .col-left { background: var(--left-bg); }
    .col-right { background: var(--right-bg); }
    .col-left, .col-right {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    .payment-box {
      width: 100%;
      max-width: 420px;
      background: #ffffff;
      border-radius: 12px;
      padding: 28px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      text-align: center;
    }
    .payment-logo { font-size: 1.6rem; font-weight: 700; margin-bottom: 1.25rem; }
    .payment-heading { margin-bottom: 60px; }
    .btn-pay { margin-top: 16px; width: 100%; height: 44px; border-radius: 8px; font-weight: 600; }
    .signup-image {
      max-width: 100%;
      max-height: 85vh;
      object-fit: contain;
      display: block;
    }
    @media (max-width: 767.98px) {
      .col-left { padding: 1rem; background-color: #fff; }
      .payment-box { padding: 16px; margin-top: 8px; margin-bottom: 8px; box-shadow: none; }
      .payment-logo { font-size: 1.25rem; margin-bottom: 0.75rem; }
      .payment-heading { margin-bottom: 20px; }
      .signup-image { max-height: 50vh; }
      .col-right { display: none; }
    }
  </style>
</head>
<body>
  <div class="row g-0 row-full">
    <!-- RIGHT: image area -->
    <div class="col-12 col-md-6 col-right">
      <img class="signup-image" src="/multitenant/img/easylogo.png" alt="Payment illustration" onerror="this.onerror=null;this.src='https://via.placeholder.com/800x600?text=Payment+Image'">
    </div>

    <!-- LEFT: payment area -->
    <div class="col-12 col-md-6 col-left">
      <div class="payment-box" aria-labelledby="payment-heading">
        <div class="payment-logo payment-heading">
          üí≥ Complete Payment
        </div>

        <p>You selected the <strong><%= plan %></strong> plan.</p>
        <p>Email: <%= email %></p>
        <p>Price: ‚Ç¶<%= price %></p>

        <form  method="POST">
          <input type="hidden" name="plan" value="<%= plan %>">
          <input type="hidden" name="email" value="<%= email %>">
          <input type="hidden" name="price" value="<%= price %>">
          <button id="pay-btn" data-email="<%= tenant.owner.email %>"
             data-amount="<%= price %>" data-plan="Starter" 
             data-tenant="<%= tenant.tenantId %>">
             Pay ‚Ç¶<%= price %>
           </button>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  const payBtn = document.getElementById("pay-btn");

  payBtn.addEventListener("click", async () => {
    const email = payBtn.dataset.email;
    const amount = payBtn.dataset.amount;
    const plan = payBtn.dataset.plan;
    const tenantId = payBtn.dataset.tenant;

    // 1Ô∏è‚É£ Initialize payment via backend
    const initRes = await fetch("/paystack/initialize", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, amount, plan, tenantId })
    }).then(res => res.json());

    if (!initRes.success) {
      alert("Payment initialization failed");
      return;
    }

    const { authorization_url, access_code, reference } = initRes.data;

    // 2Ô∏è‚É£ Open Paystack Inline
    const handler = PaystackPop.setup({
      key: "<%= process.env.PAYSTACK_PK%>", // public key
      email,
      amount: amount * 100,
      ref: reference,
      onClose: function() {
        alert("Payment window closed.");
      },
      callback: function(response) {
        alert("Payment successful! Reference: " + response.reference);
        // Optional: call your backend to verify
        fetch(`/paystack/verify/${response.reference}`)
          .then(res => res.json())
          .then(data => console.log(data));
      }
    });

    handler.openIframe();
  });
</script>
</body>
</html>
